<!--
	@license
	Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
	This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
	The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
	The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
	Code distributed by Google as part of the polymer project is also
	subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<!doctype html>
<html>
<head>
	<meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
	<title>BridgeIt Web Components Demo</title>

	<!-- Load the webcomponents polyfill -->
	<script src="../../webcomponentsjs/webcomponents-lite.min.js"></script>

	<!-- Component Imports -->
  <link rel="import" href="../../polymer/polymer.html">
	<link rel="import" href="../bridgeit-auth-provider/bridgeit-auth-provider.html">
  <link rel="import" href="bridgeit-login-paper-card.html">
  <link rel="import" href="../../paper-card/paper-card.html">
  <link rel="import" href="../../paper-toast/paper-toast.html">
  <link rel="import" href="../../iron-form/iron-form.html">
  <link rel="import" href="../../iron-form-element-behavior/iron-form-element-behavior.html">
  <link rel="import" href="../../iron-validatable-behavior/iron-validatable-behavior.html">
  <link rel="import" href="../bridgeit-styles/bridgeit-styles.html">
  <link rel="import" href="../bridgeit-styles/demo-pages.html">

</head>
<body unresolved>
  <style>
  .layout > *{
    width: 100%;
    margin: 20px;
  }
  </style>
  <template is="dom-bind" id="demo">
    <h1>BridgeIt Login Paper Card Component Demo</h1>
    <div>
      <span>
        <label>Logged In:</label>
        <span>{{isLoggedIn}}</span>
      </span>
      &nbsp;
      <span>
        <label>Access Token:</label>
        <span>{{hostAccessToken}}</span>
      </span>
      &nbsp;
      <span>
        <label>Time Remaining:</label>
        <span>{{msRemaining}}</span>
      </span>
      &nbsp;
      <paper-button onclick="logout()" raised>Logout</paper-button>
    </div>
    <div class="layout horizontal justified">
      <paper-card id="accountDetailsCard" heading="Enter Account and Realm">
        <div class="card-content">
          <paper-input id="accountInput" label="Account" required placeholder="Enter your account" value="{{account}}">
             <paper-icon-button suffix icon="clear" on-click="_clearAccount" tabindex="-1"></paper-icon-button>
          </paper-input>
          <paper-input id="realmInput" required label="Realm" placeholder="Enter your realm" value="{{realm}}">
            <paper-icon-button suffix icon="clear" on-click="_clearRealm" tabindex="-1"></paper-icon-button>
          </paper-input>
        </div>
      </paper-card>
      <bridgeit-login-paper-card heading="Please Login" username="{{username}}" password="{{password}}" error="{{loginError}}"
        auth-provider="authProvider" submit-label="Login" cancel-label="Cancel">
      </bridgeit-login-paper-card>
    </div>
    <bridgeit-auth-provider id="authProvider" account="{{account}}" realm="{{realm}}" host="dev.bridgeit.io" 
      logged-in="{{isLoggedIn}}" error="{{loginError}}" access-token="{{hostAccessToken}}" time-remaining="{{msRemaining}}"></bridgeit-auth-provider>
    <paper-toast id="toast">
        <span class="toast-hide-button" role="button" tabindex="0">{{message}}</span>
      </paper-toast>
  </template>
  <script>
  function _clearAccount(){
    document.querySelector('accountInput').value = '';
  }
  function _clearRealm(){
    document.querySelector('realmInput').value = '';
  }
  function logout(){
    document.querySelector('#authProvider').logout();
    document.querySelector('#demo').message = 'Sucessfully logged out';
  }

  //setup event handler
  setTimeout(function(){
    document.querySelector('#authProvider').addEventListener('onAfterLogin', function(){
      console.log('caught onAfterLogin event');
      document.querySelector('#demo').message = 'Sucessfully logged in';
      document.querySelector('#toast').show();
    }, false);
    window.addEventListener('bridgeit-error', function(e){
      console.error('caught bridgeit error: ', e.detail);
      document.querySelector('#demo').message = 'Error: ' + e.detail.error;
      document.querySelector('#toast').show();
    }, false);
  },100);
  
  </script>
</body>
</html>