<!--
	@license
	Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
	This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
	The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
	The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
	Code distributed by Google as part of the polymer project is also
	subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<!doctype html>
<html xmlns="http://www.w3.org/1999/html">
	<head>
		<meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
		<title>BridgeIt Web Components Demo</title>

		<script src="//cdn.lukej.me/es6-promise/1.0.0/promise.min.js"></script>
		<script>
			if( !("Promise" in window)){
				window.Promise = ES6Promise.Promise;
			}
		</script>
		<script src="//bridgeit.github.io/bridgeit.js/src/bridgeit.js"></script>
		<script src="//bridgeit.github.io/bridgeit.io.js/lib/bridgeit.io.js"></script>

		<script src="../../webcomponentsjs/webcomponents.min.js"></script>

        <!-- Load required jQuery and bootstrap font dependencies before loading component -->
        <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
        <style type="text/css">
            @font-face {
                font-family: 'Glyphicons Halflings';
                src: url('//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/fonts/glyphicons-halflings-regular.eot');
                src: url('//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/fonts/glyphicons-halflings-regular.eot?#iefix') format('embedded-opentype'), url('//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/fonts/glyphicons-halflings-regular.woff2') format('woff2'), url('//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/fonts/glyphicons-halflings-regular.woff') format('woff'), url('//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/fonts/glyphicons-halflings-regular.ttf') format('truetype'), url('//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/fonts/glyphicons-halflings-regular.svg#glyphicons_halflingsregular') format('svg');
            }
        </style>
		<link rel="import" href="bridgeit-query-editor.html">

        <!-- Load supporting components (optional) -->
        <link rel="import" href="bridgeit-query-list.html">
        <link rel="import" href="bridgeit-query-results.html">

		<link rel="stylesheet" href="demo.css"/>
		
	</head>
	<body unresolved>

		<h1>BridgeIt Query Editor Component Demo</h1>
  		<h3>Login with your BridgeIt Account Information</h3>
  		<hr/>
  		<div id="wrapper" class="container">
	  		<form>
	  			<div>
					<label>Account:
						<input id="account" type="text"/>
					</label>
				</div>
				<div>
					<label>Realm:
						<input id="realm" type="text"/>
					</label>
				</div>
				<div>
					<label>Username:
						<input id="username" type="text"/>
					</label>
				</div>
				<div>
					<label>Password:
						<input id="password" type="password"/>
					</label>
				</div>
                <a onclick="login()">Login</a>

				<div class="settings">
					<div>
						<label>Service:
                            <select onchange="document.getElementById('queryEditor').setAttribute('service', this.value)">
                                <option selected>documents</option>
                                <option>location</option>
                            </select>
						</label>
					</div>

					<div>
						<label>Collection:
                            <input id="collection" type="text" onchange="document.getElementById('queryEditor').setAttribute('collection', this.value)"/>
						</label>
					</div>

                    <div>
                        <label>
                            <a onclick="document.getElementById('queryEditor').reloadEditor()">Refresh</a>
                        </label>
                    </div>
				</div>
			</form>

              <div>
                  <label>Query URL:
                      <a id="queryURL" target="_blank"></a>
                  </label>
              </div>

			<!-- 3. Declare the element by its tag. -->
              <bridgeit-query-editor id="queryEditor"
                                     accessToken=""
                                     realm=""
                                     account=""
                                     queryURLTarget="queryURL">
              </bridgeit-query-editor>

              <div id="msgs"></div>

              <bridgeit-query-list id="queryList" for="queryEditor" tblStyle="{'margin': '0 auto'}"></bridgeit-query-list>

              <div class="buttons">
                  <button id="resetEditor" onclick="document.getElementById('queryEditor').resetEditor();">New/Reset</button>
                  <button id="runQuery" onclick="document.getElementById('queryEditor').runQuery();">Run Query</button>
                  <button id="saveQuery" onclick="document.getElementById('queryEditor').saveQuery();">Save Query</button>
                  <button id="cloneQuery" onclick="document.getElementById('queryEditor').cloneQuery();">Clone Query</button>
                  <button id="deleteQuery" onclick="document.getElementById('queryEditor').deleteQuery();">Delete Query</button>
              </div>

              <bridgeit-query-results id="queryResults" for="queryEditor" tblstyle="{'margin': '0 auto'}"></bridgeit-query-results>

              <script type="text/javascript">
                  //Listen for the queryMsgUpdated event for all components
                  document.getElementById('wrapper').addEventListener('queryMsgUpdated', function(e) {
                      var id = e.detail.id ? e.detail.id + ' : ' : '';
                      document.getElementById('msgs').innerHTML = id + e.detail.message;
                      //clear message after 10 seconds
                      setTimeout(function() {
                          document.getElementById('msgs').innerHTML = '';
                      },10000);
                  });
              </script>
			
		</div>

		<script type="text/javascript">
			function login(event){
				var account = document.getElementById('account').value;
				var realm = document.getElementById('realm').value;
				var username = document.getElementById('username').value;
				var password = document.getElementById('password').value;

				bridgeit.io.auth.connect({
					account: account,
					realm: realm,
					username: username,
					password: password
				}).then(function(){
					setCredentialsOnComponent();
                    document.getElementById('queryEditor').reloadEditor();
				})['catch'](function(){
					//try to login as admin
					bridgeit.io.auth.connect({
                        account: account,
						realm: 'admin',
						username: username,
						password: password
					}).then(function(){
						bridgeit.io.auth
						setCredentialsOnComponent();
						document.getElementById('queryEditor').reloadEditor();
					})
				});
			}

			function setCredentialsOnComponent(){

				var elem = document.getElementById('queryEditor');

				var account = bridgeit.io.auth.getLastKnownAccount();
				if( account ){
					elem.setAttribute('account', account);
					document.getElementById('account').value = account;
				}

				var realm = bridgeit.io.auth.getLastKnownRealm();
				if( realm ){
					elem.setAttribute('realm', realm);
					document.getElementById('realm').value = realm;
				}

				var token = bridgeit.io.auth.getLastAccessToken();
				if( token ){
					elem.setAttribute('accessToken', token);
					document.getElementById('username').value = bridgeit.io.auth.getLastKnownUsername();
				}
			}

			//initialize known credentials
			setCredentialsOnComponent();
			
		</script>
	</body>
</html>
