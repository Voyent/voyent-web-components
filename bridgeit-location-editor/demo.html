<!doctype html>
<html>
<head>
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
    <title>BridgeIt Web Components Demo</title>

    <!-- Load the webcomponents polyfill -->
    <script src="../../webcomponentsjs/webcomponents-lite.min.js"></script>

    <!-- Load bridgeit motion simulator component -->
    <link rel="import" href="bridgeit-location-editor.html">
    <link rel="import" href="../bridgeit-message/bridgeit-message.html">

    <!-- Demo specific CSS -->
    <link rel="stylesheet" href="../common/demo.css"/>

    <!-- Define custom styling for the component (optional) -->
    <style is="custom-style">

    </style>

</head>
<body unresolved>

<h1>BridgeIt Location Editor Component Demo</h1>
<h3>Login with your BridgeIt Account Information</h3>
<hr/>
<div class="container" style="width:100%">
    <form>
        <div>
            <label>Account:
                <input id="account" type="text"/>
            </label>
        </div>
        <div>
            <label>Realm:
                <input id="realm" type="text"/>
            </label>
        </div>
        <div>
            <label>Username:
                <input id="username" type="text"/>
            </label>
        </div>
        <div>
            <label>Password:
                <input id="password" type="password"/>
            </label>
        </div>
        <a onclick="login()">Login</a>

        <div class="settings">
            <div>
                <label>
                    <a onclick="document.getElementById('bridgeitMap').refreshMap();">Refresh Map</a>
                </label>
            </div>
        </div>
    </form>

    <bridgeit-message></bridgeit-message>
    
    <!-- Declare the element by its tag. -->
    <div id="mapContainer" style="height:500px; width:100%;">
    <bridgeit-location-editor id="bridgeitMap">
    </bridgeit-location-editor>
        </div>

</div>

<script type="text/javascript">
    function login(event){
        var account = document.getElementById('account').value;
        var realm = document.getElementById('realm').value;
        var username = document.getElementById('username').value;
        var password = document.getElementById('password').value;

        bridgeit.io.auth.connect({
            account: account,
            realm: realm,
            username: username,
            password: password
        }).then(function(){
            setCredentialsOnComponent();
            document.getElementById('bridgeitMap').refreshMap();
        })['catch'](function(){
            //try to login as admin
            bridgeit.io.auth.connect({
                account: account,
                realm: 'admin',
                username: username,
                password: password
            }).then(function(){
                setCredentialsOnComponent();
                document.getElementById('bridgeitMap').setAttribute('realm', realm);
                document.getElementById('bridgeitMap').refreshMap();
            })
        });
    }
    function setCredentialsOnComponent(){
        var elem = document.getElementById('bridgeitMap');

        var account = bridgeit.io.auth.getLastKnownAccount();
        if( account ){
            elem.setAttribute('account', account);
            document.getElementById('account').value = account;
        }

        var realm = bridgeit.io.auth.getLastKnownRealm();
        if( realm ){
            elem.setAttribute('realm', realm);
            document.getElementById('realm').value = realm;
        }

        var token = bridgeit.io.auth.getLastAccessToken();
        if( token ){
            elem.setAttribute('accesstoken', token);
            document.getElementById('username').value = bridgeit.io.auth.getLastKnownUsername();
        }
    }
    window.addEventListener('WebComponentsReady', function() {
        // imports are loaded and elements have been registered
        console.log('WebComponentsReady');

        //initialize known credentials
        setCredentialsOnComponent();
    });
</script>
</body>
</html>