<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../common/imports/voyent.html">
<link rel="import" href="../common/voyent-alert/voyent-alert-map-behaviour.html">
<link rel="import" href="../common/voyent-alert/voyent-alert-behaviour.html">
<link rel="import" href="../common/voyent-alert/voyent-alert-properties.html">
<link rel="import" href="../../paper-dialog/paper-dialog.html">

<!--
Displays a map-based tool for creating new alert templates.

Example:

    <voyent-alert-editor account="myAccount"
                                  realm="myRealm"
                                  height="500">
    </voyent-alert-editor>

@demo demo.html
-->
<dom-module id="voyent-alert-editor">
    <template>
        <style include="voyent-alert-styles" is="custom-style">
            .icon-div {
                display:inline-block;
            }
            .alert-desc {
                font-size: 13px;
                padding: 10px;
            }
            .alertTemplates .item {
                height:35px;
                padding:6px 6px 6px 10px;
                border-bottom:1px solid #ccc;
                cursor:pointer;
            }
            .alertTemplates .item:hover {
                background:rgb(235,235,235);
            }
            .alertTemplates .imgDiv,
            .alertTemplates .nameDiv,
            .alerts .imgDiv,
            .alerts .nameDiv {
                display: inline-block;
                vertical-align: middle;
                cursor: pointer;
            }
            .alertTemplates .imgDiv,
            .alerts .imgDiv {
                width: 35px;
            }
            .imgWrap {
                width: 35px;
                height: 35px;
            }
            .alertTemplates .nameDiv,
            .alerts .nameDiv {
                width: 129px;
                font-size:12px;
                line-height: 12px;
                overflow:hidden;
            }
        </style>
        <div id="container">
            <div id="map"></div><div id="sidePanel">
                <div id="propertiesPanel">
                    <template is="dom-if" if="[[_isLoggedIn]]">
                        <template is="dom-if" if="[[_showTemplateListPane]]">
                            <div class="alert-template-title">New Alert</div>
                            <template is="dom-if" if="[[_parentTemplates.length]]">
                                <div class="alertTemplates">
                                    <div class="alert-desc">
                                        <template is="dom-if" if="[[!_selectedAlertTemplateId]]">
                                            Select an alert template to create a new alert from.
                                        </template>
                                        <template is="dom-if" if="[[_selectedAlertTemplateId]]">
                                            Click a location on the map to drop the alert or press ESC to cancel.
                                        </template>
                                    </div>
                                    <template is="dom-repeat" items="{{_parentTemplates}}">
                                        <div class$="{{_getTemplateClass(item._id,_selectedAlertTemplateId)}}"
                                             on-click="_selectAlertTemplate" data-id$="{{item._id}}">
                                            <div class="imgDiv" data-id$="{{item._id}}">
                                                <img src$="{{getBadgeUrl(item.badge)}}"
                                                     class="imgWrap"
                                                     data-id$="{{item._id}}"/>
                                            </div>
                                            <div class="nameDiv" data-id$="{{item._id}}">{{_getAlertTemplateName(item)}}</div>
                                        </div>
                                    </template>
                                </div>
                            </template>
                            <template is="dom-if" if="[[!_parentTemplates.length]]">
                                <div class="alert-template-desc">
                                    There are no alert templates to create a new alert from.
                                    Please create an alert template before using this editor.
                                </div>
                            </template>
                        </template>
                        <template is="dom-if" if="[[_showPropertiesPane]]">
                            <voyent-alert-properties hide-alert-name
                                                     show-movement-accordion
                                                     _loaded-alert="{{_loadedAlert}}"
                                                     _map="{{_map}}"
                                                     _area-region="{{_areaRegion}}"
                                                     _fallback-zone="{{_fallbackZone}}"
                                                     _show-dialog-input="{{_showDialogInput}}"
                                                     _show-dialog-badge="{{_showDialogBadge}}"
                                                     _dialog-input="{{_dialogInput}}"
                                                     _dialog-badge="{{_dialogBadge}}"
                                                     _dialog-message="{{_dialogMessage}}"
                                                     _dialog-confirm-func="{{_dialogConfirmFunc}}"
                                                     _dialog-cancel-func="{{_dialogCancelFunc}}"
                                                     _alert-direction="{{_alertDirection}}"
                                                     _alert-speed="{{_alertSpeed}}"
                                                     _alert-speed-unit="{{_alertSpeedUnit}}"
                                                     _show-movement="{{_showMovement}}">
                            </voyent-alert-properties>
                        </template>
                    </template>
                    <template is="dom-if" if="[[!_isLoggedIn]]">
                        <div class="alert-template-title">Invalid Credentials</div>
                        <div class="alert-template-desc">Please login to active this panel.</div>
                    </template>
                </div>
                <div id="crudPanel"></div>
            </div></div>
        </div>
        <div id$="[[_CIRCLE_BUTTON_ID]]" class="customMapBttnWrap no-select" hidden>
            <div class="customMapBttn" title="Create a new circular proximity zone stack">
                <span>
                    <div class="customMapBttnImg">
                        <img src="../common/voyent-alert/img/drawing.png">
                    </div>
                </span>
            </div>
        </div>
        <div id$="[[_POLYGON_BUTTON_ID]]" class="customMapBttnWrap no-select" hidden>
            <div class="customMapBttn" title="Create a new polygonal proximity zone stack">
                <span>
                    <div class="customMapBttnImg">
                        <img src="../common/voyent-alert/img/drawing.png">
                    </div>
                </span>
            </div>
        </div>
        <div id$="[[_FALLBACK_ZONE_BUTTON_ID]]" class="customMapBttnWrap no-select" hidden>
            <div class="customMapBttn" title="Toggle the fallback zone">
                <span>
                    <div class="customMapBttnImg">
                        <img src="../common/voyent-alert/img/fallback_zone_bttn.png">
                    </div>
                </span>
            </div>
        </div>
    </template>
</dom-module>

<script src="voyent-alert-editor.js"></script>
