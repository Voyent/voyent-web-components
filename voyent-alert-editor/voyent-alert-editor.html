<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../common/imports/voyent.html">
<link rel="import" href="../common/voyent-alert/voyent-alert-map-behaviour.html">
<link rel="import" href="../common/voyent-alert/voyent-alert-behaviour.html">
<link rel="import" href="../common/voyent-alert/voyent-alert-properties.html">
<link rel="import" href="../../paper-dialog/paper-dialog.html">

<!--
Displays a map-based tool for creating new Alert Templates.

Example:

    <voyent-alert-editor account="myAccount"
                                  realm="myRealm"
                                  height="500">
    </voyent-alert-editor>

@demo demo.html
-->
<dom-module id="voyent-alert-editor">
    <template>
        <style include="voyent-alert-styles" is="custom-style">
            .icon-div {
                display:inline-block;
            }
            .alert-desc {
                font-size: 13px;
                padding: 10px;
            }
            .customMapBttnWrap {
                line-height: 0;
                padding-top:3px;
            }
            .customMapBttn {
                direction: ltr;
                overflow: hidden;
                text-align: left;
                position: relative;
                color: #565656;
                -webkit-user-select: none;
                padding: 4px;
                border-bottom-right-radius: 2px;
                border-top-right-radius: 2px;
                -webkit-background-clip: padding-box;
                -webkit-box-shadow: rgba(0, 0, 0, 0.298039) 0 1px 4px -1px;
                box-shadow: rgba(0, 0, 0, 0.298039) 0 1px 4px -1px;
                background-color: #FFF;
                background-clip: padding-box;
                left: 5px;
                top: 2px;
            }
            .customMapBttn:hover {
                background-color: #EBEBEB;
            }
            .customMapBttn.selected,
            .alertTemplates .item.selected {
                background-color: #c5c5c5;
            }
            .customMapBttn > span {
                display: inline-block;
            }
            .customMapBttnImg {
                width: 16px;
                height: 16px;
                overflow: hidden;
                position: relative;
            }
            .customMapBttnImg > img {
                display: inline;
            }
            .alertTemplates .item {
                height:35px;
                padding:6px 6px 6px 10px;
                border-bottom:1px solid #ccc;
                cursor:pointer;
            }
            .alertTemplates .item:hover {
                background:rgb(235,235,235);
            }
            .alertTemplates .imgDiv,
            .alertTemplates .nameDiv,
            .alerts .imgDiv,
            .alerts .nameDiv {
                display: inline-block;
                vertical-align: middle;
                cursor: pointer;
            }
            .alertTemplates .imgDiv,
            .alerts .imgDiv {
                width: 35px;
            }
            .alertTemplates .nameDiv,
            .alerts .nameDiv {
                width: 129px;
                font-size:12px;
                line-height: 12px;
                overflow:hidden;
            }
        </style>
        <div id="container">
            <div id="map"></div><div id="sidePanel">
                <div id="propertiesPanel">
                    <template is="dom-if" if="[[_creatingNew]]">
                        <div class="alertTemplates">
                            <div class="alert-desc">
                                Select an Alert Template to create a new Alert for or press ESC to cancel.
                            </div>
                            <template is="dom-repeat" items="{{_parentTemplates}}">
                                <div class$="{{_getTemplateClass(item._id,_selectedAlertTemplateId)}}" on-click="_selectAlertTemplate" data-id$="{{item._id}}" data-label$="{{item.label}}">
                                    <div class="imgDiv" data-id$="{{item._id}}" data-label$="{{item.label}}">
                                        <img src="[[pathtoimages]]/img/alert_marker.png" data-id$="{{item._id}}" data-label$="{{item.label}}"/>
                                    </div>
                                    <div class="nameDiv" data-id$="{{item._id}}" data-label$="{{item.label}}">{{_getAlertTemplateName(item)}}</div>
                                </div>
                            </template>
                        </div>
                    </template>
                    <template is="dom-if" if="[[!_creatingNew]]">
                        <template is="dom-if" if="[[_loadedAlertTemplateData.alertTemplate]]">
                            <template is="dom-if" if="[[_activatingAlert]]">
                                <div class="alert-template-title">Confirm New Alert</div>
                                <div class="alert-template-desc">
                                    <div>Start: Now</div><br/>
                                    <div>Stop: Never!</div><br/>
                                    <div>If created now, this alert would generate ? notifications. Please confirm that you would like to create this Alert.</div>
                                </div>
                            </template>
                            <template is="dom-if" if="[[!_activatingAlert]]">
                                <voyent-alert-properties _loaded-alert-template-data="{{_loadedAlertTemplateData}}" _alerts="{{_alerts}}" _map="{{_map}}"></voyent-alert-properties>
                            </template>
                        </template>
                        <template is="dom-if" if="[[!_loadedAlertTemplateData.alertTemplate]]">
                            <template is="dom-if" if="[[_parentTemplates]]">
                                <template is="dom-if" if="[[_parentTemplates.length]]">
                                    <template is="dom-if" if="[[_alerts]]">
                                        <template is="dom-if" if="[[_alerts.length]]">
                                            <div class="alerts">
                                                <div class="alert-template-title">Active Alerts</div>
                                                <div class="alert-desc">
                                                    Click an Alert on the map to load it's properties or activate the
                                                    <div class="icon-div">
                                                        <img class="icon" src="img/alert_bttn.png">
                                                    </div>
                                                    icon from the toolbar in the top-right corner to create a new Alert.
                                                </div>
                                            </div>
                                        </template>
                                        <template is="dom-if" if="[[!_alerts.length]]">
                                            <div class="alert-template-title">No Active Alerts</div>
                                            <div class="alert-template-desc">
                                                There are currently no Active Alerts. Activate the
                                                <div class="icon-div">
                                                    <img class="icon" src="img/alert_bttn.png">
                                                </div>
                                                icon from the toolbar in the top-right corner and follow the menu.
                                            </div>
                                        </template>
                                    </template>
                                </template>
                                <template is="dom-if" if="[[!_parentTemplates.length]]">
                                    <div class="alert-template-title">New Alert</div>
                                    <div class="alert-template-desc">
                                        There are no Alert Templates to create a new Alert for.
                                        Please create an Alert Template before using this editor.
                                    </div>
                                </template>
                            </template>
                            <template is="dom-if" if="[[!_parentTemplates]]">
                                <template is="dom-if" if="[[!_alerts]]">
                                    <template is="dom-if" if="[[_isLoggedIn]]">
                                        <div class="alert-template-title">Loading Active Alerts...</div>
                                    </template>
                                    <template is="dom-if" if="[[!_isLoggedIn]]">
                                        <div class="alert-template-title">Invalid Credentials</div>
                                        <div class="alert-template-desc">Please login to active this panel.</div>
                                    </template>
                                </template>
                            </template>
                        </template>
                    </template>
                </div>
                <div id="crudPanel">
                    <template is="dom-if" if="[[_parentTemplates.length]]">
                        <template is="dom-if" if="[[_loadedAlertTemplateData.alertTemplate]]">
                            <template is="dom-if" if="[[!_loadedAlertTemplateData.alertInstance]]">
                                <template is="dom-if" if="[[!_activatingAlert]]">
                                    <paper-button raised title="Back" on-click="_goBack">Back</paper-button>
                                    <paper-button raised title="Activate Now!" on-click="_toggleActivatingAlert">Activate Now!</paper-button>
                                </template>
                                <template is="dom-if" if="[[_activatingAlert]]">
                                    <paper-button raised title="Back" on-click="_goBack">Back</paper-button>
                                    <paper-button raised title="Cancel" on-click="_cancel">Cancel</paper-button>
                                    <paper-button raised title="Confirm" on-click="_updateAlertLocation">Confirm</paper-button>
                                </template>
                            </template>
                            <template is="dom-if" if="[[_loadedAlertTemplateData.alertInstance]]">
                                <template is="dom-if" if="[[!_creatingNew]]">
                                    <paper-button raised title="Back" on-click="_goBack">Back</paper-button>
                                    <paper-button raised title="Save" on-click="saveAlertTemplate">Save</paper-button>
                                    <paper-button raised title="Remove" on-click="_promptForRemovalWrp">Remove</paper-button>
                                </template>
                            </template>
                        </template>
                        <template is="dom-if" if="[[_creatingNew]]">
                             <paper-button raised title="Cancel" on-click="_cancel">Cancel</paper-button>
                         </template>
                     </template>
                </div>
            </div></div>
        </div>
        <div id="alertBttn" class="customMapBttnWrap" hidden>
            <div class="customMapBttn" title="Create a new Alert">
                <span>
                    <div class="customMapBttnImg">
                        <img data-type="tracker" src="img/alert_bttn.png">
                    </div>
                </span>
            </div>
        </div>
        <paper-dialog id="modalDialog" modal on-keyup="_dialogKeyUp" on-iron-overlay-opened="_fixModalStacking">
            <div>
                <p>{{_dialogMessage}}</p>
                <template is="dom-if" if="[[_showDialogInput]]">
                    <paper-input autofocus no-label-float on-keyup="_dialogKeyUp" value="{{_dialogInput}}"></paper-input>
                </template>
                <div class="dialog-bttns">
                    <paper-button raised title="Cancel" on-click="_closeDialog">Cancel</paper-button>
                    <paper-button raised title="Confirm" on-click="_confirmDialog">Confirm</paper-button>
                </div>
            </div>
        </paper-dialog>
    </template>
</dom-module>

<script src="voyent-alert-editor.js"></script>
