<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../paper-listbox/paper-listbox.html">
<link rel="import" href="../../paper-item/paper-item.html">
<link rel="import" href="../../paper-button/paper-button.html">
<link rel="import" href="../bridgeit-io-import/bridgeit-io-import.html">

<!--
Displays a table for viewing, sorting and querying log information stored by the BridgeIt Services. Supports Audit and Debug logs. Requires BridgeIt Account Admin credentials.

Example:

    <bridgeit-log-viewer account="myAccount"
                         paginator
                         header
                         footer>
    </bridgeit-log-viewer>

@demo demo.html
-->
<dom-module id="bridgeit-log-viewer">
    <template>
        <link type="text/css" rel="stylesheet" href="./bridgeit-log-viewer.css">
    
        <style type="text/css">
            table {
                margin:0 auto;
                border: 1px solid #ddd;
                border-spacing: 0;
                border-collapse: collapse;
                @apply(--log-viewer-table);
            }
            tr {
                @apply(--log-viewer-tr);
            }
            td {
                border: 1px solid #ddd;
                @apply(--log-viewer-td);
            }
            thead {
                border: 1px solid #ddd;
                @apply(--log-viewer-thead);
            }
            tbody {
                @apply(--log-viewer-tbody);
            }
            tfoot {
                border: 1px solid #ddd;
                @apply(--log-viewer-tfoot);
            }
            th {
                border: 1px solid #ddd;
                @apply(--log-viewer-th);
            }
            table > tbody > tr.info > td {
                background-color:#FFF;
                @apply(--log-viewer-info-td);
            }
            table > tbody > tr.debug > td {
                background-color:#d9edf7;
                @apply(--log-viewer-debug-td);
            }
            table > tbody > tr.warn > td {
                background-color:#fcf8e3;
                @apply(--log-viewer-warn-td);
            }
            table > tbody > tr.error > td {
                background-color:#f2dede;
                @apply(--log-viewer-error-td);
            }
            .buttonContainer {
                text-align:center;
                @apply(--log-viewer-button-container);
            }
            .buttonContainer button {
                @apply(--log-viewer-button);
            }
            p {
                text-align:center;
                @apply(--log-viewer-p);
            }
        </style>
        
        <template is="dom-if" if="{{_hasLogs}}">
            <div class="buttonContainer">
            <paper-dropdown-menu label="Filter by Service">
                <paper-listbox class="dropdown-content" attr-for-selected="service" selected="{{filterService}}">
                    <template is="dom-repeat" items="[[_serviceList]]" as="currentLoop">
                        <paper-item service="[[currentLoop]]">[[currentLoop]]</paper-item>
                    </template>
                </paper-listbox>
            </paper-dropdown-menu>
            
                <div>
                    <button on-click="_resetFilters">Reset Filters</paper-button>
                </div>
            </div>
            
            <template is="dom-if" if="{{paginator}}">
                <div class="buttonContainer">
                    <button on-click="lastPage" disabled="{{!_hasPreviousPage}}">{{lastPageLabel}}</button>
                    <button on-click="previousPage" disabled="{{!_hasPreviousPage}}">{{previousPageLabel}}</button>
                    <button on-click="nextPage" disabled="{{!_hasNextPage}}">{{nextPageLabel}}</button>
                    <button on-click="firstPage" disabled="{{!_hasNextPage}}">{{firstPageLabel}}</button>
                </div>
            </template>
            <table>
                <template is="dom-if" if="{{header}}">
                    <thead>
                        <template is="dom-if" if="{{_time}}">
                            <th>Time</th>
                        </template>
                        <template is="dom-if" if="{{_tx}}">
                            <th>Transaction Code</th>
                        </template>
                        <template is="dom-if" if="{{_service}}">
                            <th>Service</th>
                        </template>
                        <template is="dom-if" if="{{_realmName}}">
                            <th>Realm</th>
                        </template>
                        <template is="dom-if" if="{{_username}}">
                            <th>Username</th>
                        </template>
                        <template is="dom-if" if="{{_message}}">
                            <th>Message</th>
                        </template>
                    </thead>
                </template>
                <tbody>
                    <template is="dom-repeat" items="{{_currentPage}}">
                        <tr class$="{{item.level}}">
                            <template is="dom-if" if="{{_time}}">
                                <td>{{_formatDate(item.time)}}</td>
                            </template>
                            <template is="dom-if" if="{{_tx}}">
                                <td>{{item.tx}}</td>
                            </template>
                            <template is="dom-if" if="{{_service}}">
                                <td>{{item.service}}</td>
                            </template>
                            <template is="dom-if" if="{{_realmName}}">
                                <td>{{item.realmName}}</td>
                            </template>
                            <template is="dom-if" if="{{_username}}">
                                <td>{{item.username}}</td>
                            </template>
                            <template is="dom-if" if="{{_message}}">
                                <td>{{item.message}}</td>
                            </template>
                        </tr>
                    </template>
                </tbody>
                <template is="dom-if" if="{{footer}}">
                    <tfoot>
                        <template is="dom-if" if="{{_time}}">
                            <th>Time</th>
                        </template>
                        <template is="dom-if" if="{{_tx}}">
                            <th>Transaction Code</th>
                        </template>
                        <template is="dom-if" if="{{_service}}">
                            <th>Service</th>
                        </template>
                        <template is="dom-if" if="{{_realmName}}">
                            <th>Realm</th>
                        </template>
                        <template is="dom-if" if="{{_username}}">
                            <th>Username</th>
                        </template>
                        <template is="dom-if" if="{{_message}}">
                            <th>Message</th>
                        </template>
                    </tfoot>
                </template>
            </table>
            <template is="dom-if" if="{{paginator}}">
                <div class="buttonContainer">
                    <button on-click="lastPage" disabled="{{!_hasPreviousPage}}">{{lastPageLabel}}</button>
                    <button on-click="previousPage" disabled="{{!_hasPreviousPage}}">{{previousPageLabel}}</button>
                    <button on-click="nextPage" disabled="{{!_hasNextPage}}">{{nextPageLabel}}</button>
                    <button on-click="firstPage" disabled="{{!_hasNextPage}}">{{firstPageLabel}}</button>
                </div>
            </template>
        </template>
        <template is="dom-if" if="{{!_hasLogs}}">
            <template is="dom-if" if="{{_noLogs}}">
                <p>Sorry, there are no logs matching that query</p>
            </template>
            <template is="dom-if" if="{{!_noLogs}}">
                <p>One moment, loading logs...</p>
                <div class="throbber-wrapper">
                    <div class="throbber-loader">...</div>
                </div>
            </template>
        </template>
    </template>
</dom-module>

<script src="./bridgeit-log-viewer.js"></script>