<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../voyent-import/voyent-import.html">
<link rel="import" href="../voyent-io-import/voyent-io-import.html">
<link rel="import" href="../voyent-xio-import/voyent-xio-import.html">
<link rel="import" href="../../iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="../../paper-button/paper-button.html">
<link rel="import" href="../../paper-input/paper-input.html">
<link rel="import" href="../../paper-item/paper-item.html">
<link rel="import" href="../../paper-item/paper-item-body.html">
<link rel="import" href="../../paper-listbox/paper-listbox.html">
<link rel="import" href="../../paper-dropdown-menu/paper-dropdown-menu.html">

<!--
@demo demo.html
-->
<dom-module id="voyent-process-demo">
    <template>
        <style type="text/css">
            .overallModel {
                margin-bottom: 10px;
                min-height: 100px;
            }
            
            .overallModel, .overallModel img {
                line-height: 100px;
                vertical-align: middle;
            }
            
            .highlight, .highlightfalse, .highlighttrue {
                display: inline-block;
                padding: 10px 0 10px 0;
                transition: padding 0.2s linear, border 0.2s linear;
                -webkit-transition: padding 0.2s linear, border 0.2s linear;
            }
            
            .highlight button, .highlightfalse button, .highlighttrue button {
                background-color: transparent;
            }
            
            .highlighttrue {
                border: 1px solid rgba(0,85,0,0.8);
                padding: 10px 20px 10px 20px;
                -webkit-animation: focus 1s linear 0s infinite alternate;
                animation: focus 1s linear 0s infinite alternate;
            }
            
            .highlightinnertrue {
                outline: 3px solid rgba(0,0,85,0.9);
                padding: 5px !important;
            }
            
            .forktrue {
                vertical-align: top;
                margin-top: -25px;
            }
            
            .groupWrap {
                float: right;
            }
            
            .groupItem {
                padding: 0;
                display: block;
                line-height: normal;
            }
            
            @-webkit-keyframes focus {
                0% {
                    -webkit-box-shadow: none;
                    -moz-box-shadow: none;
                    box-shadow: none;
                }
                100% {
                    -webkit-box-shadow: inset 0px 0px 10px 5px rgba(0,85,0,0.8);
                    -moz-box-shadow: inset 0px 0px 10px 5px rgba(0,85,0,0.8);
                    box-shadow: inset 0px 0px 10px 5px rgba(0,85,0,0.8);
                }
            }
            @keyframes focus {
                0% {
                    -webkit-box-shadow: none;
                    -moz-box-shadow: none;
                    box-shadow: none;
                }
                100% {
                    -webkit-box-shadow: inset 0px 0px 10px 5px rgba(0,85,0,0.8);
                    -moz-box-shadow: inset 0px 0px 10px 5px rgba(0,85,0,0.8);
                    box-shadow: inset 0px 0px 10px 5px rgba(0,85,0,0.8);
                }
            }
        </style>
        
        <template is="dom-if" if="{{loggedIn}}">
        <paper-dropdown-menu label="Fork Gate">
            <paper-listbox class="dropdown-content" attr-for-selected="forkname" selected="{{selectedFork}}">
                <template is="dom-repeat" strip-whitespace items="[[_currentProcess.forks]]" as="fork">
                    <paper-item forkname="[[fork]]">[[fork]]</paper-item>
                </template>
            </paper-listbox>
        </paper-dropdown-menu>
        <paper-button raised on-click="startProcess">Start Process</paper-button>
        
        <h4>{{_currentProcess.title}}</h4>
        <div class="overallModel">
            <template is="dom-repeat" strip-whitespace items="{{_currentProcess.model}}" as="model">
                <div class$="highlight{{model.highlight}} fork{{model.fork}}">
                    <!-- Display an image most of the time, unless we have a waitFire in which case show a button when highlighted -->
                    <template is="dom-if" if="{{!model.highlight}}">
                        <img src="images/{{model.image}}" alt="{{model.name}}"/>
                    </template>
                    
                    <template is="dom-if" if="{{model.highlight}}">
                        <template is="dom-if" if="{{model.waitFire}}">
                            <button on-click="sendEvent" data-model$="{{model}}">
                                <img src="images/{{model.image}}" alt="{{model.name}}"
                                     on-click="sendEvent" data-model$="{{model}}"/>
                            </button>
                        </template>
                        <template is="dom-if" if="{{!model.waitFire}}">
                            <img src="images/{{model.image}}" alt="{{model.name}}"/>
                        </template>
                    </template>
                    
                    <template is="dom-if" if="{{model.fork}}">
                        <div class="groupWrap">
                            <template is="dom-repeat" strip-whitespace items="{{model.groupList}}" as="inner">
                                <div class$="highlightinner{{inner.highlight}} groupItem">
                                    <img src="images/{{inner.image}}" alt="{{inner.name}}"/>
                                </div>
                            </template>
                        </div>
                    </template>
                </div>
            </template>
        </div>
        
        </template>
    </template>
</dom-module>

<script src="../../socket.io-client/socket.io.js"></script>
<script src="../../voyent.notify.js/lib/voyent.notify.js"></script>
<script src="voyent-process-demo.js"></script>
