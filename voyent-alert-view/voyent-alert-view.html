<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../common/imports/voyent.html">
<link rel="import" href="../common/voyent-alert/voyent-alert-map-behaviour.html">
<link rel="import" href="../common/voyent-alert/voyent-alert-behaviour.html">
<link rel="import" href="../common/voyent-alert/voyent-alert-styles.html">
<link rel="import" href="../../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../iron-icons/iron-icons.html">
<link rel="import" href="../../iron-icons/device-icons.html">

<!--
Displays a map-based read-only view for displaying alert and User data.

Example:

    <voyent-alert-view account="myAccount"
                       realm="myRealm"
                       height="500">
    </voyent-alert-view>

@demo demo.html
-->
<dom-module id="voyent-alert-view">
    <template>
        <style include="voyent-alert-styles" is="custom-style">
            #fullscreenContainer[data-mode="notification"] {
                /* -15px width for the scrollbar */
                width: -webkit-calc(100% - 15px);
                width: -moz-calc(100% - 15px);
                width: calc(100% - 15px);
                margin-left:0;
            }
            #fullscreenContainer[data-is-mobile] {
                width: 100%;
                /* -43px height for the mobile div header */
                height: -webkit-calc(100% - 43px);
                height: -moz-calc(100% - 43px);
                height: calc(100% - 43px);
                margin: 43px 0 0 0;
            }
            .custom-control {
                margin: 10px;
            }
            .locationTypesCountLegend,
            .locationTypesStateLegend,
            .responseAnswersLegend{
                font-size: 11px;
                margin:10px;
                background-color: white;
                border-radius: 5px;
                box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
                padding: 10px 5px 10px 5px;
            }
            .responseAnswersLegend {
                max-width: 200px;
            }
            .responseAnswersLegend img {
                max-height: 19px;
            }
            .locationTypesStateLegend {
                padding: 5px 5px 5px 5px;
            }
            .legendStatus {
                color: #333333;
            }
            .legendStatus .enabled {
                color: green;
            }
            .legendStatus .disabled {
                color: red;
            }
            .legendImage,
            .legendText {
                padding-right: 5px;
            }
            .legendImage.mobile {
                padding-right: 3px;
            }
            .mobileHelp {
                width: 13px;
                height: 13px;
                padding: 0;
            }
            .currentLocationButton {
                background-color: white;
                border-radius: 10px;
                margin: 10px;
                width: 25px;
                height: 25px;
                color: #3579EF;
            }
            .currentLocationButton paper-icon-button {
                margin: -7px;
                padding: 10px;
            }
            
            @media print {
                .custom-control {
                    display: none;
                }
                
                .gmnoscreen, .gmnoprint, .gm-style-cc,
                .gm-bundled-control .gm-bundled-control-on-bottom {
                    display: none;
                }
            }
        </style>
        <div id="container" data-is-fullscreen$="[[_isFullscreenMode]]">
            <div id="map" data-is-fullscreen$="[[_isFullscreenMode]]"></div>
        </div>
        <div id$="[[_ZOOM_BUTTONS_ID]]" class="zoomBttns no-select" hidden>
            <div id="zoomInBttn" class="zoomBttnWrap zoomInBttnWrap" title="Zoom in">
                <div class="zoomBttn zoomInBttn">
                    <img src="../common/voyent-alert/img/tmapctrl_hdpi.png" class="zoomImg zoomInImg">
                </div>
            </div>
            <div class="zoomSeparator"></div>
            <div id="zoomOutBttn" class="zoomBttnWrap zoomOutBttnWrap" title="Zoom out">
                <div class="zoomBttn zoomOutBttn">
                    <img src="../common/voyent-alert/img/tmapctrl_hdpi.png" class="zoomImg zoomOutImg">
                </div>
            </div>
        </div>
        <div id$="[[_MAP_TYPE_BUTTONS_ID]]" class="mapTypeBttns no-select" hidden>
            <div class="mapTypeBttnWrap mapBttnWrap">
                <div id="mapBttn" class="mapTypeBttn mapBttn selected" title="Show street map">
                    Map
                </div>
                <div id="mapTerrainBttn" class="dropdownBttnWrap mapTerrainBttnWrap"
                     title="Show street map with terrain">
                    <div class="dropdownBttn">
                        <span class="checkboxWrap">
                            <div class="checkbox">
                                <img id="mapTerrainCheckbox" class="checkboxImage"
                                     src="../common/voyent-alert/img/imgs8.png">
                            </div>
                        </span>
                        <label class="label">Terrain</label>
                    </div>
                </div>
                <div id="mapPlacesBttn" class="dropdownBttnWrap mapPlacesBttnWrap"
                     title="Show street map with places">
                    <div class="dropdownBttn">
                        <span class="checkboxWrap">
                            <div class="checkbox">
                                <img id="mapPlacesCheckbox" class="checkboxImage"
                                     src="../common/voyent-alert/img/imgs8.png">
                            </div>
                        </span>
                        <label class="label">Places</label>
                    </div>
                </div>
            </div>
            <div class="mapTypeBttnWrap satBttnWrap">
                <div id="satBttn" class="mapTypeBttn satBttn" title="Show satellite imagery">
                    Satellite
                </div>
                <div id="satPlacesBttn" class="dropdownBttnWrap satPlacesBttnWrap"
                     title="Show satellite imagery with places">
                    <div class="dropdownBttn">
                        <span class="checkboxWrap">
                            <div class="checkbox">
                                <img id="satPlacesCheckbox" class="checkboxImage"
                                     src="../common/voyent-alert/img/imgs8.png">
                            </div>
                        </span>
                        <label class="label">Places</label>
                    </div>
                </div>
            </div>
        </div>
        <div id$="[[_FULLSCREEN_CONTAINER_ID]]" data-is-mobile$="[[isMobile]]" data-mode$="[[mode]]" hidden></div>
        <div id$="[[_FULLSCREEN_BUTTON_ID]]" class="custom-control no-select" hidden>
            <div id="openButton" title="Enter Fullscreen Mode">
                <img src="../common/voyent-alert/img/fullscreen_bttn.png">
            </div>
            <div id="closeButton" title="Exit Fullscreen Mode" hidden>
                <paper-button class="glow-green">Exit Fullscreen</paper-button>
            </div>
        </div>
        <div id$="[[_LOCATION_TYPE_COUNT_LEGEND_ID]]" class="locationTypesCountLegend" hidden>
            <table cellpadding="0" cellspacing="0">
                <tr>
                    <td title="Mobile">
                        <img src="../common/voyent-alert/img/circle.png">
                        &nbsp;Mobile
                        &nbsp;([[_alertHistory.mobileLocationsCount]])
                    </td>
                </tr>
                <tr>
                    <td title="Residential">
                        <img src="../common/voyent-alert/img/triangle_up.png">
                        &nbsp;Residential
                        &nbsp;([[_alertHistory.residentialLocationsCount]])
                    </td>
                </tr>
                <tr>
                    <td title="Other">
                        <img src="../common/voyent-alert/img/square.png">
                        &nbsp;Other&nbsp;([[_alertHistory.otherLocationsCount]])
                    </td>
                </tr>
            </table>
        </div>
        <div id$="[[_RESPONSE_ANSWER_LEGEND_ID]]" class="responseAnswersLegend" hidden>
            <table cellpadding="0" cellspacing="0">
                <template is="dom-repeat" strip-whitespace items="[[_answers]]" as="current">
                    <tr>
                        <td title$="[[current.text]]">
                            <img src$="[[_getMarkerColorUrl(current.color)]]"></img>
                            &nbsp;[[current.text]]
                        </td>
                    </tr>
                </template>
            </table>
        </div>
        <div id$="[[_LOCATION_TYPE_STATE_LEGEND_ID]]" class="locationTypesStateLegend" hidden>
            <table cellpadding="0" cellspacing="0">
                <tr>
                    <td class="legendImage mobile">
                        <paper-icon-button class="mobileHelp"
                                           title="Mobile locations are not displayed on the map in preview mode because their position cannot be determined until alert activation."
                                           on-click="_showMobileLocationTypeHelp"
                                           icon="help"></paper-icon-button>
                    </td>
                    <td class="legendText residential">
                        Mobile
                    </td>
                    <td class="legendStatus mobile">
                        <span class$="[[_getLocationTypeClass('mobile',_notificationFilter)]]">
                            <template is="dom-if" if="[[_isLocationTypeEnabled('mobile',_notificationFilter)]]">✔</template>
                            <template is="dom-if" if="[[!_isLocationTypeEnabled('mobile',_notificationFilter)]]">✖</template>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="legendImage residential">
                        <img src="../common/voyent-alert/img/triangle_up.png">
                    </td>
                    <td class="legendText residential">
                        Residential
                    </td>
                    <td class="legendStatus residential">
                        <span class$="[[_getLocationTypeClass('residential',_notificationFilter)]]">
                            <template is="dom-if" if="[[_isLocationTypeEnabled('residential',_notificationFilter)]]">✔</template>
                            <template is="dom-if" if="[[!_isLocationTypeEnabled('residential',_notificationFilter)]]">✖</template>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="legendImage other">
                        <img src="../common/voyent-alert/img/square.png">
                    </td>
                    <td class="legendText other">
                        Other
                    </td>
                    <td class="legendStatus other">
                        <span class$="[[_getLocationTypeClass('other',_notificationFilter)]]">
                            <template is="dom-if" if="[[_isLocationTypeEnabled('other',_notificationFilter)]]">✔</template>
                            <template is="dom-if" if="[[!_isLocationTypeEnabled('other',_notificationFilter)]]">✖</template>
                        </span>
                    </td>
                </tr>
            </table>
        </div>
        <div id$="[[_CURRENT_LOCATION_BUTTON_ID]]" class="currentLocationButton" hidden>
            <paper-icon-button icon="device:gps-fixed" noink></paper-icon-button>
        </div>
    </template>
</dom-module>

<script src="voyent-alert-view.js"></script>
